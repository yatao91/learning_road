## 同源策略

#### 简介

> **同源策略**：限制了从一个源加载的文档或脚本如何与来自另一个源的资源进行交互。
>
> 是用来隔离潜在恶意文件的重要安全机制。

#### 同源定义

> 同源策略---三个相同:
>
> - 协议相同
> - 域名相同
> - 端口相同
>
> 下列给出了相对源`http://www.a.com/path1`同源检测示例：
>
> |                URL                | 结果 |              原因              |
> | :-------------------------------: | :--: | :----------------------------: |
> | `http://www.a.com/path2/abc.html` | 成功 |          只有路径不同          |
> |     `https://www.a.com/path1`     | 失败 |    不同协议（http和https）     |
> |   `http://www.a.com:8080/path1`   | 失败 | 不同端口（http:// 80是默认的） |
> |     `http://www.b.com/path1`      | 失败 |        不同域名（a和b）        |

#### 源的继承

> 在页面中用`about:blank`或`javascript:`URL执行的脚本会继承打开该URL的文档的源。
>
> 因为这些类型的URLs没有明确包含有关原始服务器的信息。

#### 同源策略的目的

> 同源策略的**目的**: 保证用户信息的安全, 防止恶意的网站窃取数据.
>
> 同源策略是浏览器的行为，是为了保护本地数据不被`javascript`代码获取回来的数据污染，因此拦截的是客户端请求回来的数据接收，即请求发送了，服务器响应了，但是无法被浏览器接收。
>
> 例1:
>
> > 设想这样一种情况：A网站是一家银行，用户登录以后，又去浏览其他网站。如果其他网站可以读取A网站的 Cookie，会发生什么？
> >
> > 很显然，如果 Cookie 包含隐私（比如存款总额），这些信息就会泄漏。更可怕的是，Cookie 往往用来保存用户的登录状态，如果用户没有退出登录，其他网站就可以冒充用户，为所欲为。因为浏览器同时还规定，提交表单不受同源政策的限制。
> >
> > 由此可见，"同源政策"是必需的，否则 Cookie 可以共享，互联网就毫无安全可言了。
>
> 例2：
>
> > **cookie劫持**：如果没有同源策略，a域名下的网页，就可以读取浏览器中的所有cookie，如果攻击者能获取到用户登录凭证的cookie，甚至可以绕开登录流程，直接设置这个cookie的值，来访问用户的账号。

#### 限制范围

> 如果非同源, 共有三种行为受到限制:
>
> 1. `Cookie`、`LocalStorage` 和 `IndexDB` 无法读取
> 2. `DOM` 无法获得
> 3. `AJAX`请求不能发送

#### 如何允许跨源访问

> 使用[CORS](<https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS>)允许跨源访问

#### 如何阻止跨源访问

> - 阻止跨站写操作
> - 阻止资源的跨站读取
> - 阻止跨站嵌入

#### IE例外

> 当涉及到同源策略，IE有两个特有的不同点：
>
> - **授信范围（Trust Zones）**：两个相互之间高度互信的域名，如公司域名，不遵守同源策略的限制。
>
> - **端口**：IE并未将端口号加入到同源策略的组成部分之中，因此：
>
>   `http://www.a.com/path1`和`http://www.a.com:8080/path1`属于同源并且不受任何限制。
>
> 这是IE浏览器的例外，其他浏览器遵循标准同源策略。

#### 引用

> [同源策略]([https://baike.baidu.com/item/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5](https://baike.baidu.com/item/同源策略))
>
> [浏览器同源政策及其规避方法]([http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html](http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html))



